<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>图片轮播</title>
  <link rel="stylesheet" type="text/css" href="css/base.css" charset="utf-8"/>
  <script src="js/jquery2.0.0.min.js" type="text/javascript" charset="utf-8"></script>
  <style>

  </style>
</head>
<body>
  <div class="wrapper">
    <div class="title">
      <h1>图片轮播<br/></h1>
    </div> 
    <div class="slider">
      <img class="scroll-left" src="img/leftarrow.png">
      <div  class="scroll">
  
        <div class="scrollContainer">
  
          <div class="panel_1" >
            <div class="inside">
              <img id="img_left" src=" " style="width: 250px;">
              <h2 id="head_left" style="font-size: 15px;"> </h2>
              <p id="intro_left" style="font-size: 13px;">  </p>
              <a id="a_left" href=" " target="_blank">详情点击</a>
            </div>
          </div>

          <div class="panel_2">
            <div class="inside">
              <img id="img_big" src=" " style="width: 326px;">
              <h2 id="head_big" style="font-size: 20px;"> </h2>
              <p id="intro_big" style="font-size: 15px;">  </p>
              <a id="a_big" href=" " target="_blank">详情点击</a>
            </div>
          </div>
        
          <div class="panel_3">
            <div class="inside">
              <img id="img_right" src=" " style="width: 250px;">
              <h2 id="head_right" style="font-size: 15px;"> </h2>
              <p id="intro_right" style="font-size: 13pxpx;">  </p>
              <a id="a_right" href=" " target="_blank">详情点击</a>
            </div>
          </div>
        
        </div>

        <div id="left-shadow"></div>
        <div id="right-shadow"></div>

      </div>

      <img class="scroll-right" src="img/rightarrow.png">
    </div>
    <div class="commentlist">
      <div class="qPager">
        <div class="stat">第<span id="span_currcommenttotal1"> </span>页 </div>
        <ul class="turn">
          <li title="上一页" class="pre"><button id="pages_pre">上一页</button></li>
    
          <li title="下一页" class="next"><button id="pages_next">下一页</button></li>
        </ul>
        <ul class="pages">
          <li><button id="pages_1">1</button></li>
          <li><button id="pages_2">2</button></li>
          <li><button id="pages_3">3</button></li>
        </ul>
      </div>

      <div class="comments">
        <div class="comment" id="comment000">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment000" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment000"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment000"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment000"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment001">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment001" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment001"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment001"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment001"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment002">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment002" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment002"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment002"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment002"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment003">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment003" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment003"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment003"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment003"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment004">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment004" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment004"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment004"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment004"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment005">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment005" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment005"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment005"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment005"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment006">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment006" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment006"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment006"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment006"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment007">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment007" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment007"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment007"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment007"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment008">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment008" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment008"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment008"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment008"> </span>
              </div>
            </div>
          </div>
        </div>
        <div class="comment" id="comment009">
          <div class="commentcon">
            <div class="userPhoto">
              <img id="pic_comment009" src=" ">
            </div>
            <div class="bar">
              <a href=" " target="_blank" id="name_comment009"> </a>
            </div>
            <div class="con">
              <div class="text">
                <p id="com_comment009"> <br></p>
              </div>
              <div class="panel">
                <span class="timestamp" id="time_comment009"> </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="qPager">
        <div class="stat">第<span id="span_currcommenttotal2"> </span>页 </div>
        <ul class="turn">
          <li title="上一页" class="pre"><button id="pages_pre2">上一页</button></li>
    
          <li title="下一页" class="next"><button id="pages_next2">下一页</button></li>
        </ul>
        <ul class="pages">
          <li><button id="pages_12">1</button></li>
          <li><button id="pages_22">2</button></li>
          <li><button id="pages_32">3</button></li>
        </ul>
      </div>

    </div>
  </div>

  <script>
/*---------------图片轮播----------------*/
void function() {
  var url = '/js/image.json';
  var direction = false; //false-left, true-right
  var i;
  if(!parseInt(localStorage.pic_id)) i = 1;
  else i = parseInt(localStorage.pic_id)+1;//本地存储
  var timer = 3000;//计时
  var click = false;

  function processData(data) {//获取json中图片数据
    $(".panel_1").fadeIn(500);
    $(".panel_2").fadeIn(500);
    $(".panel_3").fadeIn(500);

    if(direction) i = (i+1)%data.img.length;
    else i = (i-1+data.img.length)%data.img.length;
    localStorage.pic_id = i;
    document.querySelector('#img_big').src=data.img[i].url;
    document.querySelector('#img_left').src=data.img[(i-1+data.img.length)%data.img.length].url;
    document.querySelector('#img_right').src=data.img[(i+1)%data.img.length].url;
    document.querySelector('#head_left').innerHTML=data.img[(i-1+data.img.length)%data.img.length].head;
    document.querySelector('#head_right').innerHTML=data.img[(i+1)%data.img.length].head;
    document.querySelector('#head_big').innerHTML=data.img[i].head;
    document.querySelector('#intro_left').innerHTML=data.img[(i-1+data.img.length)%data.img.length].intro;
    document.querySelector('#intro_right').innerHTML=data.img[(i+1)%data.img.length].intro;
    document.querySelector('#intro_big').innerHTML=data.img[i].intro;
    document.querySelector('#a_left').href=data.img[(i-1+data.img.length)%data.img.length].href;
    document.querySelector('#a_right').href=data.img[(i+1)%data.img.length].href;
    document.querySelector('#a_big').href=data.img[i].href;
  }

  function handler() {
    if (this.readyState == 4) {
      if (this.status == 200) {
        try {
          processData(JSON.parse(this.responseText));
        } catch(ex) {
          console.log(ex.message);
        }
      }
    }
  }

  function ajax() {
    var client = new XMLHttpRequest();
    client.onreadystatechange = handler;
    client.open('GET', url);
    client.send();
  }

  document.querySelector('.scroll-left').addEventListener('click', function() {//向左滚动按钮
    $(".panel_1").fadeOut(0);
    $(".panel_2").fadeOut(0);
    $(".panel_3").fadeOut(0);
    direction = true;
    click = true;
    ajax();
  });
  document.querySelector('.scroll-right').addEventListener('click', function() {//向右滚动按钮
    $(".panel_1").fadeOut(0);
    $(".panel_2").fadeOut(0);
    $(".panel_3").fadeOut(0);
    direction = false;
    click = true;
    ajax();
  });

  
  function func(){//页面初始化加载
    ajax();
  }
  window.onload=func();

  var int = setInterval(function() {//定时器触发轮播
          if(!click){
            direction = true;
            click = false;
            $(".panel_1").fadeOut(0);
            $(".panel_2").fadeOut(0);
            $(".panel_3").fadeOut(0);
            ajax();
          }
          else click = false;
        },timer);


  //当鼠标置于图片及文字时，停止滚动
  $('.panel_1').hover(function(){clearInterval(int)},function(){int = setInterval(function() {
          if(!click){
            direction = true;
            click = false;
            $(".panel_1").fadeOut(0);
            $(".panel_2").fadeOut(0);
            $(".panel_3").fadeOut(0);
            ajax();
          }
          else click = false;
        },timer)});
  $('.panel_2').hover(function(){clearInterval(int)},function(){int = setInterval(function() {
          if(!click){
            direction = true;
            click = false;
            $(".panel_1").fadeOut(0);
            $(".panel_2").fadeOut(0);
            $(".panel_3").fadeOut(0);
            ajax();
          }
          else click = false;
        },timer)});
  $('.panel_3').hover(function(){clearInterval(int)},function(){int = setInterval(function() {
          if(!click){
            direction = true;
            click = false;
            $(".panel_1").fadeOut(0);
            $(".panel_2").fadeOut(0);
            $(".panel_3").fadeOut(0);
            ajax();
          }
          else click = false;
        },timer)});

}();

/*---------------伪评论列表----------------*/
void function() {
  var url = '/js/comments.json';
  var i;
  if(!parseInt(localStorage.com_id)) i = 0;
  else i = parseInt(localStorage.com_id);//本地存储

  function processData(data) {//读取json中的评论数据
    localStorage.com_id = i;
    if(i==0) {
      document.querySelector('span#span_currcommenttotal1').innerHTML=1;
      document.querySelector('span#span_currcommenttotal2').innerHTML=1;
    }
    else if(i==10) {
      document.querySelector('span#span_currcommenttotal1').innerHTML=2;
      document.querySelector('span#span_currcommenttotal2').innerHTML=2;
    }
    else {
      document.querySelector('span#span_currcommenttotal1').innerHTML=3;
      document.querySelector('span#span_currcommenttotal2').innerHTML=3;
    }
    
    for(var j=0; j<10; j++){
      document.querySelector('#pic_comment'+'00'+j).src=data.comments[i+j].photo_url;
      document.querySelector('#name_comment'+'00'+j).href=data.comments[i+j].name_url;
      document.querySelector('#name_comment'+'00'+j).innerHTML=data.comments[i+j].name;
      document.querySelector('#com_comment'+'00'+j).innerHTML=data.comments[i+j].com;
      document.querySelector('#time_comment'+'00'+j).innerHTML=data.comments[i+j].time;
    }
  }

  function handler() {
    if (this.readyState == 4) {
      if (this.status == 200) {
        try {
          processData(JSON.parse(this.responseText));
        } catch(ex) {
          console.log(ex.message);
        }
      }
    }
  }

  function ajax() {
    var client = new XMLHttpRequest();
    client.onreadystatechange = handler;
    client.open('GET', url);
    client.send();
  }

  //下一页，上一页，页码按钮
  document.querySelector('button#pages_1').addEventListener('click', function() {
    i=0;
    ajax();
  });
  document.querySelector('button#pages_2').addEventListener('click', function() {
    i=10;
    ajax();
  });
  document.querySelector('button#pages_3').addEventListener('click', function() {
    i=20;
    ajax();
  });
  document.querySelector('button#pages_pre').addEventListener('click', function() {
    if(i!=0) i=i-10;
    ajax();
  });
  document.querySelector('button#pages_next').addEventListener('click', function() {
    if(i!=20) i=i+10;
    ajax();
  });
  document.querySelector('button#pages_12').addEventListener('click', function() {
    i=0;
    ajax();
  });
  document.querySelector('button#pages_22').addEventListener('click', function() {
    i=10;
    ajax();
  });
  document.querySelector('button#pages_32').addEventListener('click', function() {
    i=20;
    ajax();
  });
  document.querySelector('button#pages_pre2').addEventListener('click', function() {
    if(i!=0) i=i-10;
    ajax();
  });
  document.querySelector('button#pages_next2').addEventListener('click', function() {
    if(i!=20) i=i+10;
    ajax();
  });
  
  function func(){//评论初始化加载
    ajax();
  }
  window.onload=func;


}();


  </script>
</body>
</html>